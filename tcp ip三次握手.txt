tcp ip三次握手
背景
和女朋友异地恋一年多，为了保持感情我提议每天晚上视频聊天一次。
从好上开始，到现在，一年多也算坚持下来了。
问题
有时候聊天的过程中，我的网络或者她的网络可能会不好，视频就会卡住，听不到对方的声音，过一会儿之后才会恢复。
中间双方可能就要不断的确认网络是否恢复，但是有时候会：
她：“你可以听到了吗？”
我：“可以了，你呢？”、
她：“喂喂，你可以听到了吗？”
我：“可以了，我可以听到了，你呢？”
她：“你可以听到了吗？”
.....
这种情况很蛋疼，那么怎样才能找一个简单的办法，让两个人都确认自己可以听到对方的声音，对方也可以听到自己的声音呢？
注：以下情节纯属虚构

方案
TCP建立连接为什么是三次握手，而不是两次或四次？
TCP，名为传输控制协议，是一种可靠的传输层协议，IP协议号为6。
顺便说一句，原则上任何数据传输都无法确保绝对可靠，三次握手只是确保可靠的基本需要。
举个日常例子，打电话时我们对话如下：
 
对应为客户端与服务器之间的通信：


于是有了如下对话：
我：1+1等于几？
她：2,2+2等于几？
我：4
首先两个人约定协议
1.感觉网络情况不对的时候，任何一方都可以发起询问
2.任何情况下，若发起询问后5秒还没收到回复，则认为网络不通
3.网络不通的情况下等1min路由器之后再发起询问
 
对于我而言，发起 “1+1等于几”的询问后
1. 若5s内没有收到回复，则认为网络不通
2. 若收到回复，则我确认①我能听到她的消息 ②她能听到我的消息，然后回复她的问题的答案
对于她而言，当感觉网络情况不对的时候
1. 若没有收到我的询问，则她发起询问
2. 若收到“1+1等于几”，则她确认 ①她可以听到我的消息，然后回复我的问题的答案和她的问题“2，2+2等于几”
3. 若5s内没有收到我的回复“4”，则她确认 ②我听不见她的消息
4. 若5s内收到了我的回复“4”，则她确认 ②我可以听见她的消息
这样，如果上面的对话得以完成，就证明双方都可以确认自己可以听到对方的声音，对方也可以听到自己的声音！
这个故事可以解释TCP为什么要三次握手吗 ... 囧

关于四次挥手
先由客户端向服务器端发送一个FIN，请求关闭数据传输。
当服务器接收到客户端的FIN时，向客户端发送一个ACK，其中ack的值等于FIN+SEQ
然后服务器向客户端发送一个FIN，告诉客户端应用程序关闭。
当客户端收到服务器端的FIN是，回复一个ACK给服务器端。其中ack的值等于FIN+SEQ
 

为什么要4次挥手？
确保数据能够完整传输。
当被动方收到主动方的FIN报文通知时，它仅仅表示主动方没有数据再发送给被动方了。
但未必被动方所有的数据都完整的发送给了主动方，所以被动方不会马上关闭SOCKET,它可能还需要发送一些数据给主动方后，
再发送FIN报文给主动方，告诉主动方同意关闭连接，所以这里的ACK报文和FIN报文多数情况下都是分开发送的。
 
